<!DOCTYPE html>
<html>
<head>
  <style>
    .square {
      width: 100px;
      height: 100px;
      background-color: red;
      position: absolute;
    }
    .comparison-square {
      /* Empty class for comparison purposes only */
    }
    .line {
      stroke-width: 2px;
      stroke: blue;
    }
  </style>
</head>
<body>
  <div class="square comparison-square"></div>
  <div class="square comparison-square" style="left: 200px;"></div>
  <div class="square comparison-square" style="left: 400px;"></div>
  <div class="square comparison-square" style="left: 600px;"></div>

	<svg id="svgContainer" width="100%" height="100%" xmlns="https://www.w3.org/2000/svg">
        <line id="line" class="line" x1="0" y1="0" x2="0" y2="0"/>
    </svg>

  <script>
    var startSquare = null;
    var endSquare = null;
    var isDrawing = false;

    var line = document.getElementById("line");
    var svgContainer = document.getElementById("svgContainer");

    function handleMouseDown(square, event) {
      startSquare = square;
      var { clientX, clientY } = event;
      line.setAttribute("x1", clientX);
      line.setAttribute("y1", clientY);
	  line.setAttribute("x2", clientX);
      line.setAttribute("y2", clientY);
      isDrawing = true;
    }

    function handleMouseMove(event) {
      if (isDrawing) {
        var { clientX, clientY } = event;

        var comparisonSquares = document.getElementsByClassName("comparison-square");
        for (var i = 0; i < comparisonSquares.length; i++) {
          var square = comparisonSquares[i];
          var { left, top, width, height } = square.getBoundingClientRect();

          if (clientX >= left && clientX <= left + width && clientY >= top && clientY <= top + height) {
            line.setAttribute("x2", left + square.offsetWidth / 2);
            line.setAttribute("y2", top + square.offsetHeight / 2);
            return; // Exit the loop early if a match is found
          }
        }

        // If no match is found, set the line position to the current mouse position
        line.setAttribute("x2", clientX);
        line.setAttribute("y2", clientY);
      }
    }

    function handleMouseUp(square) {
      if (isDrawing && square.classList.contains("comparison-square")) {
        if (startSquare !== square) {
          endSquare = square;
          endSquare.style.backgroundColor = "green";
          attachEventListeners(); // Reattach the event listeners
        }
      }
      resetLine();
    }

    function resetLine() {
      line.setAttribute("x1", 0);
      line.setAttribute("y1", 0);
      line.setAttribute("x2", 0);
      line.setAttribute("y2", 0);
      isDrawing = false;
    }

    function attachEventListeners() {
      var comparisonSquares = document.getElementsByClassName("comparison-square");
      for (var i = 0; i < comparisonSquares.length; i++) {
        comparisonSquares[i].addEventListener("mousedown", function(event) {
          handleMouseDown(this, event);
        });
        comparisonSquares[i].addEventListener("mouseup", function() {
          handleMouseUp(this);
        });
      }
    }

    attachEventListeners(); // Initial attachment of event listeners

    svgContainer.addEventListener("mousemove", handleMouseMove);
    svgContainer.addEventListener("mouseup", resetLine);
    svgContainer.addEventListener("mouseleave", function() {
      resetLine();
      attachEventListeners(); // Reattach the event listeners when mouse leaves the SVG container
    });
  </script>
</body>
</html>
